<!--------------------------- Chat ---------------------->
<%= turbo_frame_tag 'rooms_controller' do %>
  <section class="main-chat">
    <article class="buy-or-sale">
      <!-------------Chats Rooms ----------------->
      <div class="user-rooms" id="user_<%= current_user.id %>_rooms">
        <div class="more-chats">
          <p class="more-chats-text">Chats</p>
          <div class="dropdown-toggle">
            <% @buyer_rooms.each do |room| %>
              <p id="client-list-open"><%= room.product.name %></p>
              <% room.user_rooms.each do |product_chat| %>

                <div class="client-list" id="client-list">
                  <div class="client">
                    <div class="left-box">
                      <%#= image_tag "Contenido/ImÃ¡gen.svg", class: "client-image" %>
                      <%= render "rooms/payment", room_id: room.id  %>
                      <%#= button_tag "Click Me", class: "payment-button", data: { room_id: room.id } %>

                      <div class="name-and-message">
                        <%= turbo_frame_tag "room_#{room.id}", class: 'room-container' do %>
                          <%= link_to room_path(room), class:"room-name", data: { turbo_frame: 'rooms_controller' } do %>
                            <% room.users.each do |room_user| %>
                              <% next if room_user.id == current_user.id %> 

                              <p style="color: green;"><%= room_user.first_name %></p>
                            <% end %>
                          <% end %>
                        <% end %>
                      </div>
                    </div>
                  </div>
                </div>
              <% end %>
            <% end %>
          </div>
        </div>
      </div>
    </article>
  </section>
<% end %>

<script>
  document.addEventListener("turbo:load", function() {
    document.addEventListener('click', function(event) {
      if (event.target.matches('.payment-button')) {
        event.preventDefault();
        const room_id = event.target.getAttribute('data-room-id');
        console.log(`Button clicked for room_id ${room_id}`);

        const form = document.querySelector(`#payment-form-${room_id}`);

        if (form) {
          form.submit();
        } else {
          console.error(`Form with ID payment-form-${room_id} not found.`);
        }
      }
    });
  });
</script>
